--==================================================
-- HITBOX FUNCTIONS
--==================================================
local function applyHitbox(player)
    if player == LocalPlayer then return end
    if player.Team == LocalPlayer.Team then
        if player.Character then
            resetHitbox(player.Character)
        end
        return
    end

    if not _G.HitboxesEnabled then return end
    if not player.Character then return end

    local char = player.Character
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    if not hrp or not hum or isDead(hum) then return end

    -- Hitbox
    hrp.Size = Vector3.new(_G.HeadSize,_G.HeadSize,_G.HeadSize)
    hrp.Shape = Enum.PartType.Ball
    hrp.Material = Enum.Material.Neon
    hrp.Transparency = 0.7
    hrp.CanCollide = false

    removeAdornment(char)

    local sphere = Instance.new("SphereHandleAdornment")
    sphere.Name = "HitboxOutline"
    sphere.Adornee = hrp
    sphere.Parent = hrp
    sphere.Radius = (_G.HeadSize/2)+0.1
    sphere.AlwaysOnTop = true
    sphere.ZIndex = 10
    sphere.Transparency = 0.6

    -- TEAM-COLORED hitbox
    if player.Team then
        sphere.Color3 = player.Team.TeamColor.Color
    else
        sphere.Color3 = Color3.new(1,1,1) -- default white if no team
    end

    -- Respawn-safe
    hum.Died:Once(function()
        resetHitbox(char)
        player.CharacterAdded:Wait()
        task.wait(0.1)
        applyHitbox(player)
    end)
end
